
@{
    ViewBag.Title = "AssestCategory";
}

<h2>AssetCategory</h2>

<link href="~/Content/css/select2.css" rel="stylesheet" />
<script src="~/Content/js/select2.full.min.js"></script>
<link href="~/Content/css/dataTables.bootstrap.min.css" rel="stylesheet" />
<script src="~/Content/js/jquery.dataTables.min.js"></script>
<script src="~/Content/js/dataTables.bootstrap.min.js"></script>


<div class="box-tools pull-right">
    <button type="button" class="btn btn-box-tool show-form text-info bg-blue-gradient" id="togglebtn" onclick="toggle()"><i class="fa fa-plus"></i>Add New</button>
</div>
<div class="box-body" id="newData">
    <div class="panel panel-primary col-md-6 center-block" style="float: none;">
        <div class="panel-body">
            <fieldset>
                <legend>Category</legend>
                <p id="checkId"></p>
                <div class="form-group">
                    <label for="ClassList">Class</label>
                    <select type="text" class="form-control" id="ClassList"></select>
                    <input type="text" class="form-control" id="ClassListEdit" >

                </div>
                <div class="form-group">
                    <label for="Category">Category ID</label>
                    <input type="text" class="form-control" id="categoryId" placeholder="Category ID">

                </div>
                <div class="form-group">
                    <label for="Category">Category</label>
                    <input type="text" class="form-control" id="categoryName" placeholder="Category Name">
                </div>
                <div class="form-group">
                    <label for="Designation"> Short Code</label>
                    <input type="text" class="form-control" id="categoryCode" placeholder="Category Code">
                </div>


                <div class="form-group">
                    <label for="">Status</label>
                    <select id="active_status" class="form-control" name="active_status">
                        <option value="true">Active</option>
                        <option value="false">InActive</option>
                    </select>

                    <input type="text" class="form-control" id="active_statusEdit">
                </div>

                <div class="text-right">
                    <button class="btn btn-sm btn-primary" id="submitCategory" onclick="subCat()">Submit</button>
                    <button class="btn btn-sm btn-primary " id="updateCategory" onclick="updateCat()" hidden><i class="ace-icon fa fa-check"></i>Update</button>
                </div>
            </fieldset>
        </div>
    </div>

</div>
<table id="datatable" class="table table-bordered table-striped compact hover" cellspacing="0" width="100%">
    <thead>
        <tr>
            @*<th>SL</th>*@
            <th class="hidden"></th>
            <th>Class</th>
            <th>Category Id</th>
            <th>Category</th>
            <th>Short Code</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in ViewBag.Data)
        {
        <tr>
            <td hidden>@item["CLASS_ID"]</td>
            <td>@item["CLASS_NAME"]</td>
            <td>@item["EXTERNAL_ID"]</td>
            <td>@item["DESCRIPTION"]</td>
            <td>@item["CODE"]</td>
            <td >@if (item["STATUS"] == 1) {
                <p>Active</p>
            } else {
                <p>Inactive</p>
                }</td>

            <td class="text-center">
                <a href="#edit_form" data-toggle="modal" class="btn btn-sm btn-primary blue" id="edit" 
                   onclick="editPressed('@item["CAT_ID"]', '@item["CLASS_NAME"]', '@item["EXTERNAL_ID"]', '@item["DESCRIPTION"]', '@item["CODE"]', '@item["STATUS"]')"
                   >
                    <span class="fa fa-pencil-square-o"></span>Edit</a>

            </td>
        </tr>
        }
    </tbody>

</table>

<script>
    $(document).ready(function () {
        getClass();   
        $('#newData').hide();
        $("#updateCategory").hide();

        $("#ClassListEdit").hide();
        $("#active_statusEdit").hide();
    });

    function getClass() {
        url = "/AssestCategory/getClass";
        $.ajax({
            url: url,
            type: 'POST',
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (response) {
                if (response.length > 0) {
                    console.log(response);
                    $('select#ClassList').html('');
                    var result = '';
                    result += "<option value='0'>Class Name</option>";
                    for (var i = 0; response.length > i; i++) {

                        result += "<option id='" + response[i].CLASS_ID + "'  data-STORAGE_ID='" + response[i].EXTERNAL_ID + "' title='" + response[i].DESCRIPTION + "' value='" + response[i].CLASS_ID + "' data-shortname='" + response[i].STATUS + "'>" + response[i].DESCRIPTION + "</option>";

                    }
                }
                $('select#ClassList').append(result);


            }


        });
    }
    function subCat() {
        alert("Hello");
        var categoryId = $('#categoryId ').val();
        var categoryName = $('#categoryName').val();
        var categoryCode = $('#categoryCode ').val();
        var ClassList = $('#ClassList ').val();
        var activeStatus = $('#active_status').val();
        

        $.ajax({
            url: "/AssestCategory/SubCat",
            type: "POST",
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify(
                {
                    categoryId: categoryId,
                    categoryName: categoryName,
                    categoryCode: categoryCode,
                    classList: ClassList,
                    activeStatus: activeStatus
                }
            ),
            dataType: "json",
            success: function (response) {
                if (response != null) {
                    alert("submitted");
                    location.reload();  
                }
            },
        });
    }

    function toggle() {
        var bId = document.getElementById("togglebtn");
        if (bId.innerHTML == "Add New") {
            bId.innerHTML = "Hide";
            $("#newData").show();
        } else {
            bId.innerHTML = "Add New";
            $("#newData").hide();
        }
    }

    function editPressed(cat_id, class_name, ex_id, des, code, status) {

        $("#updateCategory").show();
        $("#submitCategory").hide();

        $('#newData').show();

        $("#ClassList").hide();
        $("#active_status").hide();
        $("#ClassListEdit").show();
        $("#active_statusEdit").show();

        $("#ClassListEdit").val(class_name);
        $("#active_statusEdit").val(status);
        $("#categoryId").val(ex_id);
        $("#categoryName").val(des);
        $("#categoryCode").val(code);

        $("#ClassListEdit").prop("disabled", true);
        $("#categoryId").prop("disabled", true);
        $("#categoryCode").prop("disabled", true);

        

    }


        function updateCat() {
            alert("UpdateButtonPressed");
            var ClassListEdit = $("#ClassListEdit").val();
            var categoryId = $("#categoryId").val();
            var categoryName = $("#categoryName").val();
            var code = $("#categoryCode").val();
            var active_statusEdit = $("#active_statusEdit").val();

            data = {
                categoryId: categoryId,
                categoryName: categoryName,
                categoryCode: code,
                classList: ClassListEdit,
                activeStatus: active_statusEdit
            }

            $.ajax({
                url: "/AssestCategory/Updates",
                type: "POST",
                contentType: "application/json;charset=utf-8",
                data: JSON.stringify(data),
                dataType: "json",
                success: function (response) {
                    if (response != null) {
                        alert("Updated");
                        location.reload();
                    } else {

                        alert("Error");
                        location.reload();
                    }
                },
            });
        }
         
</script>